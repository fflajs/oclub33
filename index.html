<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cognitive Space Analyzer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="icon" href="favicon.ico" />
</head>

<body class="bg-gray-100 text-gray-900 flex items-center justify-center min-h-screen">
  <div class="bg-white shadow-xl rounded-2xl p-8 max-w-2xl w-full border border-gray-200">
    <h1 class="text-3xl font-bold mb-4 text-blue-800 text-center">
      Cognitive Space Analyzer
    </h1>

    <p class="text-gray-700 text-justify mb-8">
      <strong>Welcome!</strong> This application is a powerful tool designed to help individuals and teams visualize
      and understand their cognitive landscape. By answering a series of survey questions, you can generate a unique 3D
      model and a set of analytical charts that represent your knowledge, familiarity, and cognitive load on various
      topics. This visualization provides valuable insights, helping to identify areas of strength, potential
      challenges, and opportunities for growth, fostering better communication and strategic development within your
      organization.
    </p>

    <div class="text-center mb-6">
      <p class="text-gray-600">Enter your full name to login</p>
    </div>

    <div class="flex flex-col space-y-4 max-w-sm mx-auto">
      <input
        id="nameInput"
        type="text"
        placeholder="Your name"
        class="w-full border border-gray-300 rounded-lg p-2 text-center focus:outline-none focus:ring-2 focus:ring-blue-300"
      />

      <button
        id="loginBtn"
        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg transition"
      >
        Login
      </button>

      <button
        id="registerBtn"
        class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded-lg transition"
      >
        Register
      </button>

      <p id="msg" class="text-sm text-center mt-2 text-red-500"></p>
    </div>

    <footer class="text-gray-400 text-xs mt-8 text-center">
      &copy; 2025 Club33 Cognitive System
    </footer>
  </div>

  <script>
    // Supabase connection (replaces Node.js API)
    const SUPABASE_URL = "https://dtfecbqteajwtcmqudpd.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR0ZmVjYnF0ZWFqd3RjbXF1ZHBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3Mjc0MzksImV4cCI6MjA3NDMwMzQzOX0.tY8R92LdJuGMDI3kVA2nN3ALugSRP3LJKCMBuVm7vRY";

    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const nameInput = document.getElementById("nameInput");
    const loginBtn = document.getElementById("loginBtn");
    const registerBtn = document.getElementById("registerBtn");
    const msg = document.getElementById("msg");

    loginBtn.addEventListener("click", async () => {
      const name = nameInput.value.trim();
      msg.textContent = "";

      if (!name) {
        msg.textContent = "Please enter your name.";
        return;
      }

      if (name.toLowerCase() === "admin") {
        sessionStorage.setItem("loggedInUser", name);
        window.location.href = "admin.html";
        return;
      }

      msg.textContent = "Checking user...";

      try {
        const { data, error } = await sb
          .from("people")
          .select("id")
          .eq("name", name)
          .maybeSingle();

        if (error) {
          console.error(error);
          msg.textContent = "Database error. Please try again later.";
          return;
        }

        if (!data) {
          msg.textContent = "You are not registered. Please register first.";
          return;
        }

        sessionStorage.setItem("loggedInUser", name);
        msg.textContent = "Welcome " + name + "! Redirecting...";
        setTimeout(() => (window.location.href = "portal.html"), 800);
      } catch (err) {
        console.error(err);
        msg.textContent = "Connection error.";
      }
    });

    registerBtn.addEventListener("click", () => {
      window.location.href = "register.html";
    });
  </script>
</body>
</html>

